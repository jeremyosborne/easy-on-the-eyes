<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Easy on the eyes</title>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link href="/reader.css" rel="stylesheet"/>
    </head>
    <body>
        <div class="content"></div>
        <script src="//cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.js"></script>
        <script>
window.onload = function() {
    // Any data the server wants to provide to us. Server promises at minimum
    // empty object.
    var bootstrap = {{{toJSON bootstrap}}};



    var Content = function(c) {
        return {
            toHTML: function() {
                return marked(c || "");
            }
        };
    };
    // We only have one content object for now.
    var content = Content(bootstrap.content);



    var render = function(content) {
        document.querySelector(".content").innerHTML = content.toHTML();
    };
    // First render.
    render(content);



    // Attempt to read links in this single pane view.
    // We hope whatever links are left are worth reading.
    var linkInterceptor = function(ev) {
        var t = ev.target;
        if (t.tagName.toLowerCase() === "a") {
            ev.preventDefault();
            window.location.href = "/?u=" + encodeURIComponent(t.href);
        }
    };
    document.querySelector("body").addEventListener("click", linkInterceptor);
};
        </script>
    </body>
</html>
